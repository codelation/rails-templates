<div class="title">
  <h1><%= current_user.display_name %> / Billing</h1>
</div>

<div class="outer-container">
  <%= render partial: "user_account/sidebar" %>

  <div class="page">
    <fieldset>
      <legend>Subscription Plan</legend>

      <div class="current-subscription-plan">
        <% if @subscription %>
          <%= render partial: "subscription_plans/subscription_plan", locals: { subscription_plan: @subscription.plan, url: new_user_account_subscription_path }  %>
        <% else %>
          <div class="subscription-plan">
            <%= link_to new_user_account_subscription_path do %>
              <span class="name">
                No Plan
              </span>

              <span class="price">
                <span class="currency"><%= number_to_currency(0) %></span> / month
              </span>

              <span class="note">
                Not subscribed to a single user plan
              </span>
            <% end %>
          </div>
        <% end %>
        <%= link_to "Change Plan", new_user_account_subscription_path %>
      </div>

      <div class="current-subscription">
        <table>
          <thead>
            <tr>
              <th colspan="2">
                <i class="fa fa-credit-card"></i>
                Payment Method
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Credit Card:</td>
              <td>Visa ***4212</td>
            </tr>
            <tr>
              <td>Expiration:</td>
              <td>10/2017</td>
            </tr>

            <% if @subscription && @subscription.trialing? %>
              <tr>
                <td>Trial Ends:</td>
                <td><%= local_time(@subscription.trial_ends_at, "%B %e, %Y") %></td>
              </tr>
            <% else %>
              <tr>
                <td>Next payment:</td>
                <td>
                  <% if @subscription %>
                    <%= local_time(@subscription.current_period_end, "%B %e, %Y") %>
                  <% else %>
                    --
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="2">
                <%= link_to "Update Payment Method", user_account_stripe_cards_path %>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </fieldset>

    <fieldset class="payment-history">
      <legend>Payment History</legend>

      <table class="default">
        <thead>
          <tr>
            <th colspan="4">Current Billing Period</th>
            <th colspan="2">Account Balance</th>
          </tr>
          <tr>
            <td colspan="4">
              <%= local_time(@subscription.current_period_start, "%B %e, %Y") %>
              &#8211;
              <%= local_time(@subscription.current_period_end, "%B %e, %Y") %>
            </td>
            <td colspan="2"><%= number_to_currency(current_user.account_balance) %></td>
          </tr>
          <tr>
            <th>Invoice #</th>
            <th>Date</th>
            <th>Plan</th>
            <th>Payment Method</th>
            <th>Amount</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% @invoices.each do |invoice| %>
            <tr>
              <td><%= link_to invoice %></td>
              <td>2014-09-12</td>
              <td>Value</td>
              <td>Visa ***412</td>
              <td>$9.00</td>
              <td>Success</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </fieldset>
  </div>
</div>
